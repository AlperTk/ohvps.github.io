(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{448:function(a,i,e){a.exports=e.p+"assets/img/AyrikGkdStatik.edecd791.png"},496:function(a,i,e){"use strict";e.r(i);var l=e(62),n=Object(l.a)({},(function(){var a=this,i=a.$createElement,l=a._self._c||i;return l("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[l("h1",{attrs:{id:"_5-guclu-kimlik-dogrulama"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-guclu-kimlik-dogrulama"}},[a._v("#")]),a._v(" 5.\tGüçlü Kimlik Doğrulama")]),a._v(" "),l("p",[a._v("Müşteri için güçlü kimlik doğrulama, ÖHK’nın (müşterinin) kimliğinin doğrulamada kullanılan ve bir bileşenin ele geçirilmesinin diğer bileşenin güvenliğini tehlikeye atmayacağı en az iki bileşenden oluşan, bu iki bileşenin de müşterinin “bildiği”, “sahip olduğu” veya “biyometrik bir karakteristiği olan” bileşen sınıflarından farklı ikisine ait olacak şekilde seçildiği yöntemi tanımlar.")]),a._v(" "),l("p",[a._v("Ödeme ve Elektronik Para Kuruluşlarının Bilgi Sistemleri ile Ödeme Hizmeti Sağlayıcılarının Ödeme Hizmetleri Alanındaki Veri Paylaşım Servislerine İlişkin Tebliğ uyarınca hesap bilgisi hizmetinde müşterinin onayının alınması esnasında ve ödeme emri başlatma hizmetinde her bir ödeme emri başlatma işleminde "),l("strong",[a._v("HHS tarafından müşteriye güçlü kimlik doğrulama (GKD) uygulanması esastır.")]),a._v(" Buna göre:")]),a._v(" "),l("ol",[l("li",[l("p",[a._v("Hesap bilgisi hizmetinde ÖHK’nın onayının alınması esnasında "),l("strong",[a._v("Tebliğin 26 ncı maddesinin 1 inci fıkrası uyarınca")]),a._v(" HHS tarafından ÖHK’ya GKD uygulanır.")])]),a._v(" "),l("li",[l("p",[a._v("Ödeme emri başlatma hizmetinde, "),l("strong",[a._v("Tebliğin 26 ncı maddesinin 2 nci fıkrası uyarınca")]),a._v(" HHS tarafından ÖHK’ya güçlü kimlik doğrulama uygulanır ve işlem doğrulama kodu ile ÖHK’nın onayı alınır.")])]),a._v(" "),l("li",[l("p",[a._v("Ödeme emri başlatma hizmetinde, "),l("strong",[a._v("Tebliğin 26 ncı maddesinin 3 nci fıkrası uyarınca")]),a._v(" HHS tarafından ÖHK’ya güçlü kimlik doğrulama uygulanmasına ilişkin istisna veya ilave güvenlik önlemleri işbu API İlke ve Kuralları belgesinde tanımlanır.")])]),a._v(" "),l("li",[l("p",[a._v("HHS, güçlü kimlik doğrulama sürecinde ÖHK’nin sahip olduğu bileşen sınıfı olarak SMS OTP ya da SMS ile işlem doğrulama kodu kullanabilir.")])]),a._v(" "),l("li",[l("p",[a._v("HHS, aşağıdaki hallerde veya "),l("strong",[a._v("Tebliğin 10 uncu maddesinin ikinci fıkrasında")]),a._v(" belirtilen risk değerlendirmesi sonucuna göre tek bileşen ile kimlik doğrulama yapabilir.")]),a._v(" "),l("ul",[l("li",[a._v("Ödemenin göndereni ve alıcısının aynı olması,")]),a._v(" "),l("li",[a._v("Daha önce tanımlanmış güvenli alıcılar listesine ödeme yapılması,")]),a._v(" "),l("li",[a._v("ÖHK’nin talimatına istinaden gerçekleştirilen düzenli bir ödeme olması.")])])]),a._v(" "),l("li",[l("p",[a._v("Tek bileşen ile kimlik doğrulama yapılan bu işlemlerle ilgili olarak gerçekleştirilen işlemin müşteri tarafından yapıldığını ispat etme yükümlülüğü HHS’ye ait olur.")])]),a._v(" "),l("li",[l("p",[a._v("İşlem Doğrulamada "),l("strong",[a._v("Tebliğin 3 üncü maddesinin birinci fıkrası ğğ bendindeki")]),a._v(" işlem bilgisi tanımına uygun olarak aşağıdaki bilgiler ile "),l("strong",[a._v("Tebliğin 3 üncü maddesinin birinci fıkrası hh bendinde")]),a._v(" tanımlanan işleme özel üretilmiş işlem doğrulama kodu birlikte kullanılır.")]),a._v(" "),l("ul",[l("li",[l("strong",[a._v("Alıcı Unvan (Kolas akışında maskeli olarak)")]),a._v(" (ödeme emri başlatma hizmeti)")]),a._v(" "),l("li",[a._v("Tutar (ödeme emri başlatma hizmeti)")]),a._v(" "),l("li",[a._v("Referans bilgisi (8 karakterden küçük ise alanın tüm değeri, büyük ise ilk 4 ve son 4 hanesi)")])]),a._v(" "),l("p",[a._v("İşleme ait yukarıdaki bilgilerden en az biri değiştiği zaman "),l("strong",[a._v("Tebliğin 3 üncü maddesinin birinci fıkrası hh bendinde")]),a._v(" belirtildiği gibi yeni bir işlem doğrulama kodu üretilecek şekilde akış kurgulanmalıdır.")])]),a._v(" "),l("li",[l("p",[a._v("İşlem doğrulama kodunun gönderilmesinden HHS sorumludur. HHS, "),l("strong",[a._v("Tebliğin 10 uncu maddesinin ikinci fıkrasında")]),a._v(" belirtilen risk değerlendirmesi sonucuna göre işlem doğrulama kodu kullanmaksızın ÖHK’nın onayını alabilir. İşlem doğrulama kodu kullanılmayan işlemlerle ilgili olarak gerçekleştirilen işlemin ÖHK tarafından yapıldığını ispat etme yükümlülüğü HHS’ye aittir.")])]),a._v(" "),l("li",[l("p",[a._v("ÖHVPS API İlke ve Kuralları kapsamında iki adet Güçlü Kimlik Doğrulama (GKD) yöntemi kullanılacaktır:")]),a._v(" "),l("ul",[l("li",[a._v("Yönlendirmeli (Redirect) GKD Yöntemi")]),a._v(" "),l("li",[a._v("Ayrık (Decoupled) GKD Yöntemi")])])]),a._v(" "),l("li",[l("p",[a._v("HHS asgari olarak tarayıcı tabanlı Yönlendirmeli GKD yöntemini desteklemek zorundadır.")])]),a._v(" "),l("li",[l("p",[a._v("HHS’nin mobil uygulamasının bulunması durumunda tarayıcı tabanlı yönlendirmenin yanında uygulama tabanlı yönlendirme yapması zorunludur. Uygulama sahiplerinin uygulama tabanlı yönlendirme için uyumlanma son tarihleri 1 Ekim 2023’tür.")])])]),a._v(" "),l("h2",{attrs:{id:"_5-1-yonlendirmeli-guclu-kimlik-dogrulama"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-yonlendirmeli-guclu-kimlik-dogrulama"}},[a._v("#")]),a._v(" 5.1.\tYönlendirmeli Güçlü Kimlik Doğrulama")]),a._v(" "),l("p",[a._v("Yönlendirmeli GKD Yönteminde, müşteri kimlik doğrulama için YÖS tarafından HHS arayüzüne yönlendirilir.")]),a._v(" "),l("p",[a._v("Müşteri HHS’ye (uygulama veya web arayüzü vasıtasıyla) yönlendirildikten sonra müşterinin güçlü kimlik doğrulaması adım adım ve doğrudan HHS ile müşteri arasında yürütülür. GKD’nin tamamlanmasından sonra müşteri tekrar YÖS uygulamasına yönlendirilir.")]),a._v(" "),l("p",[a._v("Yönlendirmeli GKD Yöntemi için üst düzey örnek iş akışı aşağıdaki adımlardan oluşur:")]),a._v(" "),l("ol",[l("li",[a._v("YÖS, GKD için HHS tarafından tanımlanan arayüze (tarayıcı ya da uygulama) yönlendirme yapar.")]),a._v(" "),l("li",[a._v("Müşteri, YÖS arayüzünden ayrılır, yönlendirildiği HHS arayüzü üzerinde kimlik doğrulama işlemlerini gerçekleştirir.")]),a._v(" "),l("li",[a._v("GKD tamamlandıktan sonra müşteri, YÖS arayüzüne tekrar yönlendirilir ve işlem sonucu görüntülenir.")])]),a._v(" "),l("p",[a._v("Yönlendirmeli GKD için temel gereklilikler şunlardır:")]),a._v(" "),l("ul",[l("li",[a._v("Ödeme hizmeti (hesap bilgisi veya ödeme emri başlatma hizmeti) tarayıcı ya da uygulama tabanlı bir şekilde sunulabilir. Bu nedenle, "),l("strong",[a._v("YÖS ve HHS’lerin Yönlendirmeli GKD için asgari olarak tarayıcı tabanlı yönlendirme akışını desteklemeleri gerekmektedir.")])])]),a._v(" "),l("p",[l("strong",[a._v("Tarayıcı Tabanlı Yönlendirme")])]),a._v(" "),l("p",[a._v("Yönlendirmeli GKD Yönteminde; rıza isteğine başarılı yanıt alındıktan sonra, ÖHK, kimlik doğrulama için YÖS tarafından HHS arayüzüne yönlendirilir.\nYÖS, yönlendirme akışını kendi sunucusundan karşılayacağı bir istek ile başlatmalıdır. YÖS web arayüzündeki bu yapı, 302 yanıt kodu ve yanıt başlığındaki Location değeri ile ÖHK tarayıcısını HHS adresine yönlendirmelidir. Bu sayede GKD, HHS tarafında başlayabilir.")]),a._v(" "),l("p",[a._v("YÖS tarafındaki yönlendirme servisi için örnek response;")]),a._v(" "),l("div",{staticClass:"language- extra-class"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[a._v("HTTP/1.1 302 Found\nLocation: {{hhsYonAdr}}\n")])])]),l("p",[a._v("ÖHK, HHS’ye (uygulama veya web arayüzü vasıtasıyla) yönlendirildikten sonra ÖHK'nin güçlü kimlik doğrulaması HHS ile ÖHK arasında yürütülür. GKD’nin tamamlanmasından sonra ÖHK tekrar YÖS uygulamasına yönlendirilir.")]),a._v(" "),l("p",[a._v("HHS, yönlendirme akışını kendi sunucusundan karşılayacağı bir istek ile başlatmalıdır. HHS web arayüzündeki bu yapı, ÖHK'nin oturumunu güvenli bir şekilde kapatmalıdır. Ardından 302 yanıt kodu ve yanıt başlığındaki Location değeri ile ÖHK tarayıcısını YÖS adresine yönlendirmelidir.")]),a._v(" "),l("div",{staticClass:"language- extra-class"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[a._v("HTTP/1.1 302 Found\nLocation: {{yosYonAdr}}&rizaDrm=Y&yetKod=xx&rizaNo=yy&rizaTip=O\n")])])]),l("p",[a._v("HHS’nin web arayüzüne,")]),a._v(" "),l("ul",[l("li",[a._v("HHS’nin mobil uygulamasının olmadığı,")]),a._v(" "),l("li",[a._v("ÖHK’nın ödeme hizmetini (hesap bilgisi veya ödeme emri başlatma hizmeti) sunduğu mobil cihazda HHS uygulamasının yüklü olmadığı,"),l("br"),a._v("\ndurumlarda yönlendirme yapılır.")])]),a._v(" "),l("p",[a._v("YÖS’ün mobil uygulaması varsa mobil cihazda uygulamadan tarayıcıya, YÖS’ün mobil uygulaması yoksa ödeme hizmetinin sunduğu cihazda (Kişisel Bilgisayar veya Mobil Cihaz) tarayıcı üzerinden yönlendirme yapılır.")]),a._v(" "),l("p",[l("strong",[a._v("Uygulama Tabanlı Yönlendirme")])]),a._v(" "),l("p",[a._v("ÖHK’nın ödeme hizmetini (hesap bilgisi veya ödeme emri başlatma hizmeti) YÖS’ün mobil uygulaması ile kullanıyorsa, aynı mobil cihazda HHS’nin mobil uygulamasının yüklenmiş olması durumunda, ÖHK doğrulamasının HHS mobil uygulaması tarafından yapılması için uygulama tabanlı yönlendirme yapılır. Böylece ÖHK, ödeme hizmetine erişim için HHS’nin mobil kanalına erişim sırasında kullandığı doğrulama yöntemini ile doğrulanabilir.")]),a._v(" "),l("p",[l("strong",[a._v("HHS'nin mobil uygulaması olması durumunda hhsYonAdr olarak universal link kullanması gerekmektedir.")])]),a._v(" "),l("p",[l("strong",[a._v("Tablo 5: Yönlendirmeli Güçlü Kimlik Doğrulama Kanalları")])]),a._v(" "),l("table",[l("thead",[l("tr",[l("th",[a._v("Doğrulama Yöntemi")]),a._v(" "),l("th",[a._v("YÖS Olası Ortam")]),a._v(" "),l("th",[a._v("HHS Olası Ortam")])])]),a._v(" "),l("tbody",[l("tr",[l("td",[l("strong",[a._v("Tarayıcı Tabanlı Yönlendirme")])]),a._v(" "),l("td",[a._v("Kişisel Bilgisayar (masaüstü, dizüstü)/Mobil Cihaz")]),a._v(" "),l("td",[a._v("Kişisel Bilgisayar (masaüstü, dizüstü) / Mobil Cihaz")])]),a._v(" "),l("tr",[l("td",[l("strong",[a._v("Uygulama Tabanlı Yönlendirme")])]),a._v(" "),l("td",[a._v("Mobil Cihaz")]),a._v(" "),l("td",[a._v("Mobil Cihaz")])])])]),a._v(" "),l("h2",{attrs:{id:"_5-2-ayrık-guclu-kimlik-dogrulama"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-ayrık-guclu-kimlik-dogrulama"}},[a._v("#")]),a._v(" 5.2.\tAyrık Güçlü Kimlik Doğrulama")]),a._v(" "),l("p",[a._v('Ayrık Güçlü Kimlik Doğrulama, bir kullanıcının kimliğinin, bir işlem başlatıldıktan sonra ayrı bir şekilde doğrulandığı yönteme verilen addır. Bu GKD modelinde, kimlik doğrulama işlem sürecinden "ayrıştırılmıştır". Kullanıcılar, başka bir arayüze yönlendirilmek yerine ( tarayıcı veya uygulama tabanlı yönlendirme gibi), ayrı bir kanal üzerinden (telefonlarında bir uygulama bildirimi gibi) işlemi doğrulamaları için bildirim alır.\nKullanıcı, işlemi tamamen ayrı bir cihaz veya uygulama kullanarak doğrulayabilir.')]),a._v(" "),l("p",[a._v("Ayrık GKD uygulamalarının farklı örnekleri bulunmaktadır. Ancak yaygın olan yaklaşım, bir web arayüzü ve bir mobil uygulamanın kombinasyonunu kullanmayı içerir.")]),a._v(" "),l("p",[l("strong",[a._v("Mobil uygulaması bulunan HHS'ler için Ayrık GKD desteklenmesi zorunludur.")])]),a._v(" "),l("p",[a._v("Örnek bir akış şu şekildedir:")]),a._v(" "),l("ol",[l("li",[l("strong",[a._v("İşlem Başlatma (YÖS Web Arayüzü):")]),a._v(" ÖHK bir işlemi YÖS’ün web arayüzünde başlatır. YÖS uygulaması, ÖHK'nın tekil bir kullanıcı kimliğini rızaya ekleyerek bir rıza başlatma işlemini HHS’ye iletir. HHS, tekil kullanıcı kimliğini kullanarak ÖHK'nın mobil uygulamasına bir bildirim gönderir.")]),a._v(" "),l("li",[l("strong",[a._v("Kimlik Doğrulama İsteği (HHS Mobil Uygulama):")]),a._v(" ÖHK Mobil uygulama bildirimi alır ve mobil uygulama ÖHK'ya  kimlik doğrulama isteği sunar. HHS’nin BDDK tarafından belirlenmiş GKD yöntemlerine uygun davranması beklenmektedir.")]),a._v(" "),l("li",[l("strong",[a._v("Kimlik Doğrulama Onayı (HHS Mobil Uygulama):")]),a._v(" Mobil uygulama, ÖHK’nın kimlik doğrulama girişimini doğrular. Başarılı olursa rıza onayı sonrası mobil uygulama, 'Ayrık Yetkilendirme Başarılı' olay bildirimini YÖS’e gönderir.")]),a._v(" "),l("li",[l("strong",[a._v("İşlem Onayı (YÖS Web Arayüzü):")]),a._v(" YÖS,  HHS'den gelen 'Ayrık Yetkilendirme Başarılı' olay bildirimine konu olan rızayı kullanarak yetkilendirme koduna erişir. Bundan sonraki süreç erişim belirteci alınması servisi ile devam eder.")])]),a._v(" "),l("p",[l("strong",[a._v("Ayrık Güçlü Kimlik Doğrulamanın Olay Bildirim Servisleri ile olan Bağımlılıkları")])]),a._v(" "),l("p",[a._v("Ayrık GKD sürecinde; HHS'nin yetkilendirme kodunu YÖS'e iletmesi için gerekli önkoşul olan ÖHK doğrulaması adımının tamamlanmasını olay bildirimi ile YÖS'e yapması gerekmektedir.\nBu nedenle YÖS'lerin eğer Ayrık GKD sürecini destekleyecek ise;  /olay-dinleme endpointini açarak olay bildirimi alması zorunludur.")]),a._v(" "),l("h3",{attrs:{id:"_5-2-1statik-model"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-1statik-model"}},[a._v("#")]),a._v(" 5.2.1\tStatik Model")]),a._v(" "),l("p",[a._v("YÖS'ün ÖHK'yı tanıdığı ve ÖHK'ya ait tanımlayıcı bilgileri HHS'ye aktarabildiği durumda kullanılmaktadır. Buradaki ÖHK'ya ait tanımlayıcı bilgiler TCKN, MNO , YKN, PNO, GSM, IBAN olarak belirlenmiştir.")]),a._v(" "),l("p",[a._v("Akış aşağıdaki gibi kurgulanmıştır:")]),a._v(" "),l("img",{attrs:{src:e(448),width:"75%"}}),a._v(" "),l("ul",[l("li",[l("p",[a._v("ÖHK, YÖS uygulaması üzerinde işlem başlatır.")])]),a._v(" "),l("li",[l("p",[a._v("ÖHK, YÖS uygulaması içerisinde, farklı bir ortam üzerinden HHS doğrulamasını gerçekleştirmek istediğini belirtir. ÖHK'yı tanıma tip ve değerleri YÖS ÖHK'dan talep edebileceği gibi, YÖS sisteminde hali hazırda kayıtlı bilgilerle de akışı devam ettirebilir. "),l("br")]),a._v(" "),l("ul",[l("li",[a._v("ÖHK, YÖS'ün müşterisi ve YÖS uygulamasına login ise tek seferlik ödeme akışı başlatamaz.")]),a._v(" "),l("li",[a._v("YÖS önyüzde ÖHK'dan aldığı ohkTanimTip ve ohkTanimDeger değerlerini kimlik tür ve kimlik değeri alanlarına atamamalıdır.")])])]),a._v(" "),l("li",[l("p",[a._v('YÖS, ayrık GKD ile işlem başlatabileceği HHS\'lerin listesini HHS API\'de yer alan "ayrikGKD"="E" parametresi ile alabilir.')])]),a._v(" "),l("li",[l("p",[a._v("YÖS, ÖHK bilgileri ile rıza oluşturur. Rıza nesnesi içerisinde yer alan GKD nesnesinde ilgili parametreler aşağıdaki şekilde doldurulur:"),l("br"),l("br")]),a._v(" "),l("ul",[l("li",[l("p",[l("strong",[a._v("ohkTanimTip ve ohkTanimDeger parametreleri")]),l("br"),a._v("\nBu metodda; ayrikGkd nesnesi içerisindeki \"ohkTanimTip\" parametresi TR.OHVPS.DataCode.ohkTanimTip sıralı veri tiplerinden TCKN, MNO , YKN, PNO, GSM, IBAN değerlerinden birini alabilir. ohkTanimDeger parametresi de seçilen tipe ait ÖHK'ya ait değeri içermelidir.Rıza başlatma akışı içerisinde kimlik bilgisinin olduğu durumlarda; ÖHK'ya ait kimlik verisi(kmlk.kmlkVrs) ile ayrık GKD içerisinde yer alan OHK Tanım Değer alanı (ayrikGkd.ohkTanimDeger) birebir aynı olmalıdır.Kimlik alanı içermeyen tek seferlik ödeme emri akışlarında bu kural geçerli değildir. GSM ve IBAN değerleri sadece tek seferlik ödemelerde kullanılabilir."),l("br")]),a._v(" "),l("p",[a._v("YÖS'ten ohkTanimTip olarak gelen IBAN bilgisi sadece ÖHK'yı tanımak için kullanılabilir. Tanım tipi IBAN ile başlatılan bir işlemde ÖHK, başka bir IBAN ile ödeme başlatabilir.")]),a._v(" "),l("p",[a._v("Kurumsal müşteriler için kmlkTur ve kmlkVrs alanları ohkTanimTip ve ohkTanimDeger alanlarında gönderilmelidir."),l("br")])]),a._v(" "),l("li",[l("p",[l("strong",[a._v("yetYntm parametresi")]),l("br"),a._v('\nyetYntm parametresi  Ayrık GKD  akışını ifade eden "A" değerini almalıdır. '),l("br")])])])])]),a._v(" "),l("p",[a._v("Örnek bir istek :"),l("br"),a._v("\nPOST/ohvps/obh/s1.1/odeme-emri-rizasi")]),a._v(" "),l("p",[a._v("RizaNesnesi")]),a._v(" "),l("div",{staticClass:"language- extra-class"},[l("pre",{pre:!0,attrs:{class:"language-text"}},[l("code",[a._v('{\n...\n  "gkd": {\n    "yetYntm": "A",\n    "yonAdr": "https://yosAdr?drmKod",\n     "ayrikGkd" :{\n         "ohkTanimTip" : "TCKN" \n         "ohkTanimDeger": "11232123212"\n     }    \n  },\n...\n}\n')])])]),l("ul",[l("li",[l("p",[a._v('YÖS, ayrık GKD ile işlem başlatabileceği HHS\'lerin listesini HHS API\'de yer alan "ayrikGKD"="E" parametresi ile alabilir.\nYÖS, ayrık GKD desteklemeyen HHS\'ye Ayrık GKD yöntemiyle rıza başlatma isteği yapması durumunda HHS tarafından '),l("strong",[a._v("TR.OHVPS.Business.DecoupledAuthenticationNotSupported")]),a._v(" hatası iletilmelidir.")])]),a._v(" "),l("li",[l("p",[a._v("HHS, YÖS'ün AYRIK_GKD_BASARILI ve AYRIK_GKD_BASARISIZ olay tipleri için olay aboneliğinin varlığını kontrol eder. "),l("br"),a._v("YÖS iki olay tipine de abone olmak zorundadır. Eğer olay aboneliği yoksa HHS tarafından "),l("strong",[a._v("TR.OHVPS.Business.EventSubscriptionNotFound")]),a._v(" hata kodu iletilmelidir.")])]),a._v(" "),l("li",[l("p",[a._v('HHS "gkd" nesnesi için alan kontrollerini gerçekleştirir. '),l("br"),a._v(' "yetYntm" = "A" gönderilmiş ise "ayrikGkd" nesnesinin dolu gönderilmesi zorunludur. Gönderilmemesi durumunda HHS tarafından '),l("strong",[a._v("TR.OHVPS.Resource.InvalidFormat")]),a._v(" hata kodu iletilmelidir.")])]),a._v(" "),l("li",[l("p",[a._v("Rıza başlatma akışı içerisinde kimlik bilgisinin olduğu durumlarda; ÖHK'ya ait kimlik verisi(kmlk.kmlkVrs) ile ayrık GKD içerisinde yer alan OHK Tanım Değer alanı (ayrikGkd.ohkTanimDeger) birebir aynı olmalıdır. Aynı olmadığı durumda HHS tarafından "),l("strong",[a._v("TR.OHVPS.Business.CustomerInfoMismatch")]),a._v(" hatası iletilmelidir.\nKimlik alanı içermeyen tek seferlik ödeme emri akışlarında bu kural geçerli değildir. GSM ve IBAN değerleri sadece tek seferlik ödemelerde kullanılabilir.")])]),a._v(" "),l("li",[l("p",[a._v('Tek seferlik ödeme işlemlerinde "ohkTanimTip" = "GSM"/"IBAN" olarak gönderilmiş ise, HHS sisteminde bu GSM/IBAN ile eşleşen müşterileri taramalıdır. GSM/IBAN bilgisi ÖHK bazında tekil bir kullanıcıya erişim imkanı sağlamaz ise '),l("strong",[a._v("TR.OHVPS.Business.InvalidCustomerInfo")]),a._v(" hatasını iletmelidir."),l("br")])]),a._v(" "),l("li",[l("p",[a._v("Kontrollerin başarılı olması durumunda HHS rızayı oluşturur ve ÖHK tekil verisi ile ulaştığı ÖHK'ya bilgilendirme mesajı gönderir. "),l("br"),a._v("    Bilgilendirme mesajı kısa mesaj ya da anlık bildirim mesajı olabilir. "),l("br")]),a._v(" "),l("ul",[l("li",[l("p",[a._v("Kurumsal müşteriler için, hangi kullacıya bildirim gitmesi isteniyor ise, rıza aşamasında o kişi ayrikGkd nesnesinde gönderilir. HHS'nin rıza içerisindeki ohkTur değerine göre,  gelen bildirime verilen cevaba uygun uygulamasını açmalıdır. Kurumsal ÖHK için rıza geldi ise, kurumsal giriş sayfası; bireysel ÖHK için rıza geldi ise bireysel giriş sayfası müşterinin önüne açılmalıdır ve ilgili hesaplara erişime izin vermelidir.")])]),a._v(" "),l("li",[l("p",[a._v("ÖHK'ya bir bildirim gelmemesi durumunda, HHS kendi sisteminde GKD sürecine devam edemez. 5 dakika sonunda rıza durumu Yetki Bekleniyor'dan Rıza İptal / Süre Aşımı (İptal kod 04) durumuna çeker.")])])])]),a._v(" "),l("li",[l("p",[a._v('ÖHK, HHS sisteminden gelen bildirim mesajını alır. HHS sistemine login olduktan sonra işleme onay verilmezse veya GKD kontrolleri başarısız olursa HHS Olay Bildirim servisleri aracılığı ile GKD sürecinin sonlandığını YÖS\'e iletir. Olay tipi "AYRIK_GKD_BASARISIZ" olacak şekilde bir POST /olay-dinleme servis çağrısı yapılır.YÖS kendisine gelen olay bildirimi ile\nrıza sorgulaması yaparak iptal detay kodunu öğrenebilir.')])]),a._v(" "),l("li",[l("p",[a._v('ÖHK, HHS sisteminde login olduktan sonra işleme onay verirse; HHS tarafından rıza ile ilişkili yetkod değeri üretilir.HHS, YÖS\'e ÖHK için "yetkod" değeri üretildiğinin bilgisini Olay Bildirim servisleri aracılığı ile iletir. Olay tipi "AYRIK_GKD_BASARILI" olacak şekilde bir POST /olay-dinleme servis çağrısı yapılır.')])]),a._v(" "),l("li",[l("p",[a._v('YÖS kendisine gelen olay bildirimi ile "yetkod" değerinin HHS\'de üretildiğinin bilgisini alır. "yetkod" değerini öğrenebilmek için HHS\'yi sorgulaması gerekmektedir. '),l("br"),a._v("\nHHS'nin açacağı  "),l("RouterLink",{attrs:{to:"/v1.1.0/contents/erisim-belirteci.html#yetkilendirme-kodu-api"}},[a._v("GET /yetkilendirme-kodu endpointi")]),a._v("  ile bu bilgiye erişebilir.")],1)]),a._v(" "),l("li",[l("p",[a._v('YÖS, "yetkod" ile POST /erisim-belirteci endpointinden erişim belirteci alır. Böylelikle ÖHK\'nın Ayrık GKD süreci tamamlanmış olur.')])])]),a._v(" "),l("h2",{attrs:{id:"_5-3-yonlendirme-bildirim-adresleri-ve-durum-kodu-parametresi"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-yonlendirme-bildirim-adresleri-ve-durum-kodu-parametresi"}},[a._v("#")]),a._v(" 5.3.\tYönlendirme/Bildirim Adresleri ve Durum Kodu Parametresi")]),a._v(" "),l("p",[a._v("CSRF Ataklarından korunmak için ve YÖS uygulamasının bir önceki durumunu restore edebilmesi için; YÖS tarafından iletilen yönlendirme ve bildirim adreslerine , Oauth2 standartlarındaki state parametresine eşdeğer,  "),l("strong",[a._v("durum kodu (drmKod)")]),a._v(" parametresinin eklenmesi gerekmektedir. Durum kodu parametresi YÖS tarafından üretilen, tekil ve kolay tahmin edilemeyen bir değer olmalıdır. Rıza isteği gönderimi aşamasında oluşturulmalıdır. YÖS uygulamasında uygun bir yerde saklanmalıdır (cookie, session, local storage gibi) .")]),a._v(" "),l("p",[a._v("Durum kodu, rıza isteğindeki yönlendirme adresine parametre olarak eklenir.  GKD süreci sonrasında yetki kodu ile birlikte bu bilgi, HHS tarafından YÖS’e iletilir. YÖS sakladığı değer ile parametre olarak gelen değerin eşitliğini kontrol eder. Aynı ise erişim belirteci almak üzere akışı ilerletir. Farklı ise işlemi keser.")]),a._v(" "),l("h2",{attrs:{id:"_5-4healthcheck-api"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-4healthcheck-api"}},[a._v("#")]),a._v(" 5.4\tHealthcheck API")]),a._v(" "),l("p",[l("strong",[a._v("GET /health")])]),a._v(" "),l("p",[a._v("HHS’lerin sunacağı bu servis, düzenli olarak BKM tarafından çağırılarak servislerin ayakta olup olmadıklarının kontrolünün sağlanması planlanmaktadır.")]),a._v(" "),l("p",[a._v("Başarılı yanıtta Http 200 kodu dönülmelidir."),l("br"),a._v("\nBaşarılı Yanıt:")]),a._v(" "),l("table",[l("thead",[l("tr",[l("th",[a._v("Alan Adı")]),a._v(" "),l("th",[a._v("JSON Alan Adı")]),a._v(" "),l("th",[a._v("Format")]),a._v(" "),l("th",[a._v("Koşullu  / İsteğe Bağlı")]),a._v(" "),l("th",[a._v("Açıklama")])])]),a._v(" "),l("tbody",[l("tr",[l("td",[a._v("status")]),a._v(" "),l("td",[a._v("status")]),a._v(" "),l("td",[a._v("AN2..20")]),a._v(" "),l("td",[a._v("Z")]),a._v(" "),l("td",[a._v("“UP”, “DOWN” değerlerini alabilir.")])])])]),a._v(" "),l("h2",{attrs:{id:"_5-5-guclu-kimlik-dogrulama-kontrolleri"}},[l("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-guclu-kimlik-dogrulama-kontrolleri"}},[a._v("#")]),a._v(" 5.5  Güçlü Kimlik Doğrulama Kontrolleri")]),a._v(" "),l("p",[a._v("ÖHK, GKD için HHS uygulamasına yönlendirildiğinde, HHS’nin çeşitli kontroller yaparak işlemin doğruluğunu teyit etmesi gerekmektedir.\nYapılması gereken kontrollere ait temel senaryolar aşağıdaki tabloda belirtilmiştir. Bu senaryolar baz alınarak HHS’ler tarafından zenginleştirilebilir.")]),a._v(" "),l("p",[a._v("Aşağıdaki tabloda yer alan 07-13 arası Rıza İptal Detay Kodlarının oluştuğu senaryolar, HHS uygulamasında yapılan kullanıcı doğrulama öncesi ve sonrası olarak iki adımda incelenmelidir.")]),a._v(" "),l("p",[a._v("HHS tarafında, kullanıcı doğrulama öncesinde yapılan kontroller neticesinde verilemeyen rızalar için ‘04’ : Süre Aşımı : Yetki Bekleniyor iptal kodu atanır. HHS'nin YÖS uygulamasına 04 kodunu iletmesi beklenmez. YÖS zaman aşımı neticesinde rıza statüsünü sorgulayarak öğrenir."),l("br"),a._v("\nKullanıcı doğrulandıktan sonra rıza verilemiyorsa ilgili hata kodunun YÖS'e iletilmesi beklenmektedir. Kullanıcı doğrulama sonrası YÖS'e iletilen rıza iptal detay kodu ile HHS veri modelinde tutulan rıza ile ilişkili rıza iptal detay kodu, aynı değeri alacak şekilde güncellenmelidir. YÖS, HHS tarafından kendine iletilen rıza iptal detay kodunu kendi veri modelinde güncellemelidir.")]),a._v(" "),l("p",[a._v("Zorunlu olarak belirtilen hata durumlarının HHS’ler tarafından gerçeklenmesi ve uygun hata kodlarının YÖS’e iletilmesi; ileride oluşabilecek mutabakatlaşma sorunlarını ortadan kaldırabilecek, yapılacak raporlamalar kapsamında sistem ve süreç iyileştirmelerine katkı sağlayacak, son kullanıcı açısından da alınan hataya yönelik bilgilendirici içerik sağlayacaktır.")]),a._v(" "),l("p",[a._v("Hata açıklamaları; hata koduna uygun ya da uyumlu olmak kaydıyla, HHS ve YÖS tarafından farklı şekillerde sunulabilir.")]),a._v(" "),l("p",[l("strong",[a._v("GKD Sırasında yapılması gereken kontroller")])]),a._v(" "),l("table",[l("thead",[l("tr",[l("th",[a._v("Rıza İptal Detay Kodu")]),a._v(" "),l("th",[a._v("HHS hata açıklaması*")]),a._v(" "),l("th",[a._v("Yös ekranında listelenecek örnek mesaj metni*")]),a._v(" "),l("th",[a._v("Örnek Senaryo")]),a._v(" "),l("th",[a._v("Zorunlu / Opsiyonel")])])]),a._v(" "),l("tbody",[l("tr",[l("td",[a._v("07")]),a._v(" "),l("td",[a._v('Rıza mevcut ve durumu "Yetkilendirildi" veya "Yetki Kullanıldı"')]),a._v(" "),l("td",[a._v("Yetki Hatası")]),a._v(" "),l("td",[a._v("ÖHK, "),l("strong",[a._v("kullanıcı doğrulama işlemi tamamlandıktan sonra")]),a._v(" YÖS ekranında ileri - geri yaparak ya da ÖHK'nın yönlendirme adresini kopyalayarak tarayıcıya yapıştırması ile tekrar HHS'ye yönlendirir. Bu durumda HHS bu rıza iptal detay kodunu iletir."),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Zorunlu")])]),a._v(" "),l("tr",[l("td",[a._v("08")]),a._v(" "),l("td",[a._v("Rızano ile kimlik bilgileri uyuşmazlığı.")]),a._v(" "),l("td",[a._v("İşlem gerçekleştirilememiştir.")]),a._v(" "),l("td",[a._v("YÖS tarafından başlatılan rıza içerisinde yer alan kimlik bilgisi (örn:TCKN) ile HHS'de başarılı kimlik doğrulama yapılan ÖHK'nın bilgilerinin uyuşmadığı durumda "),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Zorunlu")])]),a._v(" "),l("tr",[l("td",[a._v("09")]),a._v(" "),l("td",[a._v("ÖHK'nın HHS'de ilgili ürününün olmadığı durum (hesap/kart)")]),a._v(" "),l("td",[a._v("Gösterilebilecek hesap/kart bulunamamıştır.")]),a._v(" "),l("td",[a._v("HHS, kullanıcı doğrulama yaptıktan sonra, ÖHK'nın uygun statülü hesabının olmadığı durumda "),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Zorunlu")])]),a._v(" "),l("tr",[l("td",[a._v("10")]),a._v(" "),l("td",[a._v("ÖHK'nın Açık Bankacılık kanalı işleme kapalı")]),a._v(" "),l("td",[a._v("ÖHK'nın Açık Bankacılık kanalı işleme kapalı")]),a._v(" "),l("td",[a._v("Açık bankacılığı ayrı bir kanal olarak tanımlamış HHS'lerde, "),l("br"),a._v("ÖHK kullanıcı doğrulama yaptıktan sonra yapılan kontrollerde, ÖHK'nın işlemlerini AB kanalına kapatmış olması durumunda  "),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Opsiyonel")])]),a._v(" "),l("tr",[l("td",[a._v("11")]),a._v(" "),l("td",[a._v("ÖHK'nın HHS'deki hesaplarında yeterli yetkisinin olmaması")]),a._v(" "),l("td",[a._v("Yetki hatası")]),a._v(" "),l("td",[a._v("1- Kurumsal firma kullanıcılarının hesaplar üzerinde işlem yetkisinin olmaması durumunda "),l("br"),a._v(" 2- Bireysel ortak hesaplarda hesap kısıtı bulunuyorsa (para çıkışına izin verilmediği durum) "),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Zorunlu")])]),a._v(" "),l("tr",[l("td",[a._v("12")]),a._v(" "),l("td",[a._v("HHS’nin,  ÖHK özelinde yaptığı kontrollerin başarısız olması")]),a._v(" "),l("td",[a._v("Yetki hatası")]),a._v(" "),l("td",[a._v("HHS'nin, kullanıcı doğrulama sonrası ÖHK için iç sistemlerinde yaptığı kontrollerin başarısız olması. Örneğin: Müşterinin henüz bankacılık hizmet sözleşmesi gibi Internet şubesi üzerinde işlem yapmasını engelleyen eksikleri olması durumunda veya kurumsal kullanıcıda vekalet süresinin dolması/eksik doküman olması durumunda kanal üzerinde işlem yapamadığı durum "),l("br"),l("br"),a._v("HHS ve YÖS'ler veri modellerini bu bilgi doğrultusunda güncellemelidir.")]),a._v(" "),l("td",[a._v("Opsiyonel")])]),a._v(" "),l("tr",[l("td",[a._v("13")]),a._v(" "),l("td",[a._v("ÖHK isteği ile GKD’den vazgeçilmesi")]),a._v(" "),l("td",[a._v("Müşteri işlemden vazgeçmiştir.")]),a._v(" "),l("td",[a._v("HHS ekranında yer alan VAZGEÇ butonuna basılması durumu (ÖHK,HHS uygulamasında kullanıcı doğrulama yaptıktan sonra VAZGEÇ butonu olabilir.)")]),a._v(" "),l("td",[a._v("Zorunlu")])]),a._v(" "),l("tr",[l("td",[a._v("14")]),a._v(" "),l("td",[a._v("GKD İptali: Fraud Şüphesi")]),a._v(" "),l("td",[a._v("İşlem gerçekleştirilememiştir.")]),a._v(" "),l("td",[a._v("HHS Fraud şüphesi nedeniyle işlemin devamına izin vermez."),l("br"),a._v("HHS'nin, fraud kontrollerinin ödeme başlatma hizmeti için yapması ve “14- GKD İptali: Fraud Şüphesi” ile rıza iptalini gerçekleştirmelidir. HBH servislerinde HHS'nin rıza iptal kodu 14 ile işlemi kesmesi HHS'nin kendi insiyatifindedir yani opsiyoneldir.")]),a._v(" "),l("td",[a._v("Koşullu")])]),a._v(" "),l("tr",[l("td",[a._v("99")]),a._v(" "),l("td",[a._v("Diğer")]),a._v(" "),l("td",[a._v("İşlem gerçekleştirilememiştir.")]),a._v(" "),l("td",[a._v("Oluşabilecek diğer senaryolar.")]),a._v(" "),l("td",[a._v("Zorunlu")])])])]),a._v(" "),l("p",[a._v("GKD sırasında iletilen rıza no eğer HHS’nin sisteminde bulunamazsa durumu güncellenecek bir rıza no da olmayacaktır. HHS kendi önyüzünde bu duruma uygun bir mesaj gösterebilir. YÖS’e de Diğer hata kodu ile bu durumu iletebilir.")])])}),[],!1,null,null,null);i.default=n.exports}}]);