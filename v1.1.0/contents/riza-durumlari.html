<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4. Rıza Durumları | (ÖHVPS) API İLKE VE KURALLARI</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content=" ">
    
    <link rel="preload" href="/assets/css/0.styles.69b9d1cc.css" as="style"><link rel="preload" href="/assets/js/app.64463254.js" as="script"><link rel="preload" href="/assets/js/6.3a0f8e93.js" as="script"><link rel="preload" href="/assets/js/2.7b95e2d3.js" as="script"><link rel="preload" href="/assets/js/18.48adad56.js" as="script"><link rel="prefetch" href="/assets/js/10.a549017a.js"><link rel="prefetch" href="/assets/js/11.a122fc63.js"><link rel="prefetch" href="/assets/js/12.cc79327a.js"><link rel="prefetch" href="/assets/js/13.f9447bea.js"><link rel="prefetch" href="/assets/js/14.faa5a8d4.js"><link rel="prefetch" href="/assets/js/15.f665ccb2.js"><link rel="prefetch" href="/assets/js/16.2f39932f.js"><link rel="prefetch" href="/assets/js/17.dbb2824c.js"><link rel="prefetch" href="/assets/js/19.a5898b64.js"><link rel="prefetch" href="/assets/js/20.7a666f9f.js"><link rel="prefetch" href="/assets/js/3.afac92cb.js"><link rel="prefetch" href="/assets/js/4.6a2e424b.js"><link rel="prefetch" href="/assets/js/5.02c42bd5.js"><link rel="prefetch" href="/assets/js/7.b19a3b17.js"><link rel="prefetch" href="/assets/js/8.d2b85ac5.js"><link rel="prefetch" href="/assets/js/9.fbec8fdb.js">
    <link rel="stylesheet" href="/assets/css/0.styles.69b9d1cc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/TCMB_logo.svg.png" alt="(ÖHVPS) API İLKE VE KURALLARI" class="logo"> <span class="site-name can-hide">(ÖHVPS) API İLKE VE KURALLARI</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/v1.1.0/contents/tanim-ve-kisitlamalar" class="sidebar-heading clickable open"><span>Version 1.1.0</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/v1.1.0/contents/tanim-ve-kisitlamalar.html" class="sidebar-link">1. Tanımlar ve Kısıtlamalar</a></li><li><a href="/v1.1.0/contents/kapsam-ve-dayanak.html" class="sidebar-link">2. Kapsam ve Dayanak</a></li><li><a href="/v1.1.0/contents/temel-prensipler.html" class="sidebar-link">3. Temel Prensipler</a></li><li><a href="/v1.1.0/contents/riza-durumlari.html" aria-current="page" class="active sidebar-link">4. Rıza Durumları</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/v1.1.0/contents/riza-durumlari.html#_4-1-hesap-bilgisi-hizmeti-rıza-durum-degisiklikleri" class="sidebar-link">4.1.	Hesap Bilgisi Hizmeti Rıza durum değişiklikleri</a></li><li class="sidebar-sub-header"><a href="/v1.1.0/contents/riza-durumlari.html#_4-2-odeme-bilgisi-hizmeti-rıza-durum-degisiklikleri" class="sidebar-link">4.2.	Ödeme Bilgisi Hizmeti Rıza Durum Değişiklikleri</a></li></ul></li><li><a href="/v1.1.0/contents/gkd.html" class="sidebar-link">5. Güçlü Kimlik Doğrulama</a></li><li><a href="/v1.1.0/contents/odeme-emri-baslatma-hizmeti.html" class="sidebar-link">6. Ödeme Emri Başlatma Hizmeti</a></li><li><a href="/v1.1.0/contents/hesap-bilgisi-hizmeti.html" class="sidebar-link">7. Hesap Bilgisi Hizmeti</a></li><li><a href="/v1.1.0/contents/hhs-yos-api.html" class="sidebar-link">8. HHS ve YÖS API</a></li><li><a href="/v1.1.0/contents/erisim-belirteci.html" class="sidebar-link">9. Erişim Belirteci API</a></li><li><a href="/v1.1.0/contents/ekler.html" class="sidebar-link">10. Ekler</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4-rıza-durumları"><a href="#_4-rıza-durumları" class="header-anchor">#</a> 4. Rıza Durumları</h1> <p>ÖHK, Ödeme Emri Başlatma Hizmetine ya da Hesap Bilgisi Hizmetine müşteri rızasının tesisi ile başlar. ÖHK’nın YÖS uygulaması üzerinden yaptığı işlemler neticesinde rıza durumları değişebilir.
Rıza’nın alabileceği durum kodları şu şekilde belirlenmiştir.</p> <p><strong>B: Yetki Bekleniyor</strong> – İlk rıza talebinde<br> <strong>Y: Yetkilendirildi</strong> – Başarılı GKD sonrası yetKod üretildiğinde<br> <strong>K: Yetki Kullanıldı</strong> – Erişim Belirteci alındığında<br> <strong>E: Yetki ödeme emrine dönüştü</strong> – ÖBHS için<br> <strong>S: Yetki Sonlandırıldı</strong><br>
    HBHS için : Erişimin Geçerli Olduğu Son Tarih geldiğinde<br>
    ÖBHS için : Yenileme belirteci Son Tarihi geldiğinde<br> <strong>I :Yetki Iptal</strong><br>
Rıza iptal durumu ise gerek raporlama gerekse müşteri deneyimi perspektifinden doğru   bilgilendirmeler yapılabilmesi açısından aşağıdaki gibi detay kodları ile zenginleştirilmiştir:</p> <blockquote><p><strong>Rıza Iptal Detay Kodu:</strong></p></blockquote> <blockquote><blockquote><p><strong>‘01’ :	Yeni Rıza Talebi ile İptal</strong><br> <strong>‘02’ :	Kullanıcı İsteği ile HHS üzerinden İptal</strong><br> <strong>‘03’ :	Kullanıcı İsteği ile YÖS üzerinden İptal</strong><br> <strong>‘04’ :	Süre Aşımı : Yetki Bekleniyor</strong><br> <strong>‘05’ :	Süre Aşımı : Yetkilendirildi</strong><br> <strong>‘06’ :	Süre Aşımı : Yetki Ödemeye Dönüşmedi</strong><br> <strong>‘07’ :	GKD iptali : Aynı rıza no ile mükerrer çağrımı</strong><br> <strong>‘08’ :	GKD iptali : Rızano ile TCKN uyuşmaması</strong><br> <strong>‘09’ :	GKD iptali : Uygun ürünü bulunmuyor</strong><br> <strong>‘10’ :	GKD iptali : HHS Açık Bankacılık kanalı işleme kapalı</strong><br> <strong>’11’ :	GKD iptali : Hesap Yetki Sorunu</strong><br> <strong>‘12’ :	GKD iptali : ÖHK HHS müşterisi değil</strong><br> <strong>‘13’ :	GKD iptali : ÖHK HHS kontrollerini aşamadı</strong><br> <strong>‘14’ :	GKD iptali : Başarısız GKD</strong><br> <strong>‘15’ :	GKD iptali : ÖHK isteği ile GKD’den vazgeçildi</strong><br> <strong>‘16’ :	GKD iptali : Diğer</strong></p></blockquote></blockquote> <p>4.1 ve 4.2 bölümlerinde detaylandırılan rıza durum değişikliklerinde statü kodları kullanılmıştır.</p> <p><strong>Örneğin B⇨ I/01 denildiğinde “Yetki Bekleniyor” statüsünden “Yetki İptal” statüsüne Rıza Iptal Detay Kodu da ‘01’ yani ‘Yeni Rıza Talebi ile İptal’ olarak güncellenmelidir ifade edilmiştir.</strong></p> <p>ÖHK verdiği rıza sırasında seçtiği hesaplarından biri kapatılırsa, diğer hesaplara ait bilgileri görmeye devam eder. Ancak ÖHK’nın hesabına ait bilgilerinin YÖS'e iletilmesini istemediği durumda, rızasını tamamen iptal ederek yeni hesap listesi ile yeni rıza vermesi gerekmektedir. Yani hesap kapanması nedeniyle rıza geçerliliğini yitirmez. Müşterinin proaktif olarak bu hesabı rızadan çıkarması durumunda rıza iptali olur.</p> <p>Rıza iptal edilmediği ve geçerli olduğu sürece kapalı hesaplar için diğer çevrimiçi kanallarda uygulanan yöntem izlenmelidir. Diğer çevrimiçi kanallarda kapalı hesaplara ilişkin bilgi dönülmüyor ise ÖHVPS'den de dönüş yapılmaz. ÖHK’nın rıza onayı verdiği açık hesaplarının tümü HHS tarafında kapatıldığı durumda, yine aynı şekilde HHS çevrimiçi kanallarında koyduğu kurallara göre bu hesaplarının YÖS uygulamasında gösterilmesine karar verir.</p> <p>Hesap kapama ve ticari kullanıcıların hesaplar üzerindeki yetki değişiklikleri HHS'nin iç sistemleri tarafından yapılan kontrollerle yönetilir. Buradaki değişiklikler ile HHS sistemsel olarak rıza iptali gerçekleştiremez. Müşteri izni ve onayı dahilinde rıza iptal gerçekleştirilmesi gerekmektedir.</p> <h2 id="_4-1-hesap-bilgisi-hizmeti-rıza-durum-degisiklikleri"><a href="#_4-1-hesap-bilgisi-hizmeti-rıza-durum-degisiklikleri" class="header-anchor">#</a> 4.1.	Hesap Bilgisi Hizmeti Rıza durum değişiklikleri</h2> <p><strong>Kural</strong>: 1 ÖHK'nın 1 YÖS için 1HHS'de Y, K, B statüsünde 1 rızası olabilir.
Bir ÖHK hem kişisel olarak hem de bir kurumun kullanıcısı olabilir. Bu durumda kurum ve kişisel rıza aynı anda mevcut olabilmelidir. Rıza nesneleri, HHS tarafından uygun şekilde yönetilmelidir.</p> <ol><li><p>Hesap Bilgisi Rızası isteği HHS’ye iletilir.<br>
a.	HHS müşteriye ait içeride rıza var mı kontrol eder. Eğer yoksa RIZA = B Yetki Bekleniyor tipinde yeni rıza no oluşturur.<br>
b.	Eğer içeride rıza varsa<br>
     i. <strong>Rıza tipi Yetki Bekleniyor (B) ise</strong> HHS, sistemde Yetki Bekleniyor (B) statüsünde kayıt olduğu için, öncelikle eski kaydı Iptal(I) statüsüne getirir. Rıza İptal Detay Kodu “Yeni Rıza Talebi ile iptal” olmalıdır. <strong>B ⇨ I / 01</strong> Sonrasında, <strong>Yetki Bekleniyor (B)</strong> statüsünde yeni rıza oluşturur.</p> <p>     ii. <strong>Rıza Tipi Yetkilendirildi (Y) ve Yetki Kullanıldı (K) ise</strong> Müşterinin halihazırda verilmiş bir rızası vardır. HHS, önce rıza iptali yapılmasına dair hata döner. <strong>TR.OBHS.Resource.ConsentMismatch</strong></p> <p>     iii.	<strong>Rıza tipi Yetki Sonlandırıldı(S) ise</strong> <strong>Yetki Bekleniyor (B)</strong> tipinde yeni rıza no oluşturur.</p> <p>     iv.	<strong>Rıza tipi Iptal (I) ise</strong> <strong>Yetki Bekleniyor (B)</strong> tipinde yeni rıza no oluşturur.</p></li> <li><p>GKD başarılı bir şekilde tamamlandığında Rıza durumu Yetki Bekleniyor’dan Yetkilendirildi’ye güncellenir. <strong>B ⇨ Y</strong></p> <ul><li><p>GKD'nin gerçekleşmediği durumlardan HHS haberdar olmayabilir.</p> <p>Müşteri GKD yapmadan ayrılmış olabilir. (ÖR: Tarayıcıyı kapatmış olabilir) Rıza Yetki Bekleniyor (B) statüsünde kalır.  5 dakika içerisinde sistem tarafından Yetki Bekleniyor (B) statüsündeki kayıtlar Yetki İptal  : Yetki Bekleniyor Süre Aşımı olarak güncellenir.  <strong>B ⇨ I / 04</strong> Bkz. 9. Madde.</p></li> <li><p>GKD'nin gerçekleşmediği durumlardan HHS haberdardır. HHS yonlendirme adresinin query parametrelerine <strong>rizaIptDtyKod</strong> değerini ekleyerek bu durumu YÖS’e bildirmek zorundadır.</p> <ul><li><p>Rıza durumunun  “Yetkilendirildi&quot; , “Yetki Kullanıldı” olduğu durum.  Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨  I / 07</strong></p></li> <li><p>Rızano ile kimlik bilgileri uyuşmazlığı.  Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 08</strong></p></li> <li><p>ÖHK'nın HHS'de ilgili ürününün olmadığı durum (hesap/kart) Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨I / 09</strong></p></li> <li><p>Açık bankacılık kanalınız işleme kapalıdır.Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨I / 10</strong></p></li> <li><p>Kullanıcının HHS'deki hesaplarında yeterli yetkisinin olmama durumu  Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 11</strong></p></li> <li><p>ÖHK'nın ilgili HHS müşterisi olmadığı durum Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 12</strong></p></li> <li><p>HHS’nin ÖHK için yaptığı kontrollerin başarısız olduğu durum Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨ I / 13</strong></p></li> <li><p>Müşteri kendini doğrulayamamış olabilir. Başarısız GKD Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 14</strong></p></li> <li><p>ÖHK isteği ile GKD’den vazgeçildiği durum Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 15</strong></p></li> <li><p>Diğer Yetki Bekleniyor ⇨  Yetki Iptal  <strong>B ⇨  I / 16</strong></p></li></ul></li></ul></li> <li><p>Müşteri hesaplarında/izin türlerinde/Erişimin Geçerli Olduğu Son Tarih bilgilerinden bir ya da birden fazlasında güncelleme yapmak için YÖS ekranına girer.</p></li></ol> <p>    a.	YÖS önce Rıza İptal API'sini çağırır. Sonra yeni değerlerle yeni bir rıza isteğinde bulunur. Tekrar GKD gerekir.</p> <p>    b.	YÖS rıza iptal yapmadan yeni rıza alma akışına başlarsa 1.b akışı devreye girer.</p> <p>    c.	Rıza güncelleme ilerleyen sürümlerde ele alınacaktır.</p> <ol start="4"><li><p>Erişim Belirteci'nin yetkilendirme kodu ile çağrımı yapıldığında; HHS, rıza numarasının Y - Yetkilendirildi statüsünde olduğunu kontrol etmelidir. Y statüsünde ise erişim belirteci tahsis edilir.
Erişim belirteci alındığında rıza durumu K: Yetki Kullanıldı yapılır. <strong>Y ⇨K</strong></p> <ul><li>Rıza durumu Yetki İptal - I statüsünde ya da Yetki Sonlandırıldı - S ise  <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Bekleniyor - B ya da Yetki Kullanıldı - K  ise <strong>TR.OBHS.Resource.ConsentMismatch</strong> hatası dönülmelidir.</li></ul> <p>Yenileme belirteci karşılığı erişim belirteci alınması sırasında rıza durumları aşağıdaki şekilde kontrol edilmelidir.</p> <ul><li>Hesap bilgisi akışında sadece Yetki Kullanıldı - K rıza durumlarında yenileme belirteci karşılığı erişim belirteci alınabilir.</li> <li>Rıza durumu Yetki İptal - I statüsünde ise <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Sonlandırıldı ise  öncelikle  Yenileme Belirteci Geçerlik Süresi kontrolü yapılmalıdır. Geçerli bir Yenileme Belirteci olmadığı görülür ise <strong>TR.OBHS.Connection.InvalidToken</strong> hatası dönülmelidir.  Aksi halde <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Bekleniyor - B ya da Yetkilendirildi - Y  ise <strong>TR.OBHS.Resource.ConsentMismatch</strong> hatası dönülmelidir.</li></ul></li> <li><p>Sorgulama: HBHS, rıza alma akışına başlamadan önce, daha önce oluşturulmuş bir hesap bilgisi-rizasi kaynağının durumunu, isteğe bağlı olarak alabilir. Rıza numarası ile sorgulama yapılır.</p></li> <li><p>Hesap Bilgisi Rızasının İptali: HBHS üzerinden ya da HHS üzerinden yapılan rıza iptallerinde Rıza statüsü  İptal Edildi olarak güncellenir. Rıza numarası ile iptal sağlanır.</p> <p>a. HHS üzerinden rıza iptali yapmış olabilir.  Rıza durumu sorgulanır.</p> <p>Rıza numarası B- Yetki Bekleniyor ve Y-Yetkilendirildi ve K Kullanıldı statüsüne sahip ise iptal statüsüne getirilir. Rıza gnclzmn timestamp ile güncellenir.
HHS, Rıza iptalinde aynı zamanda erişim belirtecini de invalid hale getirmelidir.</p> <p><strong>B ⇨ I / 02</strong><br> <strong>Y ⇨ I / 02</strong><br> <strong>K ⇨ I / 02</strong></p> <p>b.	YÖS üzerinden yapılacak iptal işleminde yine Y ve B ve K statüsünde ise iptal edilebilir.</p> <p><strong>B ⇨ I / 03</strong><br> <strong>Y ⇨ I / 03</strong><br> <strong>K ⇨ I / 03</strong></p> <p>Rıza numarası Yetki Sonlandırıldı (S) statüsüne sahip ise iptal gerçekleşmez. “Rıza'nız iptal edilebilecek statüde değildir.” hatası müşteriye yansıtılır. <strong>TR.OBHS.Resource.ConsentMismatch</strong></p></li> <li><p>ÖHK’nın verdiği rıza süresi dolmuş olabilir.
Erişimin Geçerli Olduğu Son Tarih geldiğinde Rıza durumu Yetki Kullanıldı’dan Yetki Sonlandırıldı durumuna çekilmelidir.  <strong>K ⇨ S</strong></p></li> <li><p>Hesaplar, Bakiye ve işlemler servislerinde erişim belirteci kontrolü ve sonrasında rıza kontrolü yapılmalıdır. Geçerli bir erişim belirteci yok ise <strong>TR.OBHS.Connection.InvalidToken</strong> hatası dönülmelidir.</p> <p>YÖS bu servisleri çağırırken ÖHK rızası iptal statüsünde ise bu iptal HHS üzerinden yapılmış olabilir. (YÖS kendi uygulamasından iptal akışını gerçekleştirdiğinde, yeni rıza alarak işlemlere başlayacağı düşünülmektedir. Ancak yine de YÖS tarafından sorgulama yapılırsa ConsentRevoked hatası HHS’den dönmelidir.) Rıza durumu Iptal ve Rıza Iptal Detay Kodu 2 ise YÖS’ün HHS’ üzerinden yapılmış İptal’den haberdar olabilmesi için aşağıdaki hata kodu iletilmelidir:</p> <p><strong>TR.OBHS.Resource.ConsentRevoked</strong></p> <p>Rıza durumu &quot;K: Yetki Kullanıldı&quot; dışındaki statülerde işleme devam edilmemelidir. Bu durumda <strong>TR.OBHS.Resource.ConsentMismatch</strong> hatası verilmelidir.</p> <p>Rıza sorgulama, Rıza iptal API'lerinde ilgili rıza kaydı bulunamaz veya sorgulayan kurumun yetkisi yoksa (örn : YÖS’ün farklı bir YÖS’e ait rıza noyu sorgulaması)<br> <strong>TR.OBHS.Resource.NotFound hatası</strong> verilmelidir.</p></li> <li><p>HHS/YÖS tarafında rıza bilgileri belirli aralıklarla sistem kullanıcısı tarafından taranır:
5 dakikadan uzun süredir “Yetki Bekleniyor” statüsünde kalan kayıtların statüleri güncellenir.
Yetki Bekleniyor  ⇨ Rıza İptal  / Süre Aşımı : Yetki Bekleniyor <strong>B ⇨ I / 04</strong></p> <p>5 dakikadan uzun süredir “Yetkilendirildi” statüsünde kalan kayıtlar statüleri güncellenir.
Yetkilendirildi     ⇨ Rıza İptal / Süre Aşımı: Yetkilendirildi <strong>B ⇨ I / 05</strong><br>
Yukarıda bahsedilen, YÖS Süre Aşımı nedeniyle rıza iptal statüsü güncellemelerini yapmadan önce HHS’yi sorgulayarak rıza durumunu öğrenmeli ve süre aşımı dışında bir kodu varsa aynı kodla kendi sistemini güncellemelidir.<br>
Erişimin Geçerli Olduğu Son Tarih geldiğinde rıza statüsü Yetki Kullanıldı’dan Yetki Sonlandırıldı’ya güncellenir. <strong>K ⇨ S</strong></p></li></ol> <h2 id="_4-2-odeme-bilgisi-hizmeti-rıza-durum-degisiklikleri"><a href="#_4-2-odeme-bilgisi-hizmeti-rıza-durum-degisiklikleri" class="header-anchor">#</a> 4.2.	Ödeme Bilgisi Hizmeti Rıza Durum Değişiklikleri</h2> <p><strong>Kural</strong>: 1 ÖHK'nın 1 YÖS için 1HHS'de istediği kadar rızası olabilir.
Kurum ve kişisel rıza aynı anda mevcut olabilmelidir. Rıza nesneleri, HHS tarafından uygun şekilde yönetilmelidir.</p> <ol><li><p>Ödeme Emri Rızası isteği HHS’ye iletilir. İçeride rıza olup olmamasına bakılmaksızın Yetki Bekleniyor (B) tipinde yeni rıza no oluşturur.</p></li> <li><p>GKD başarılı bir şekilde tamamlandığında Rıza durumu Yetki Bekleniyor’dan Yetkilendirildi’ye güncellenir.  <strong>B ⇨ Y</strong></p> <ul><li><p>GKD'nin gerçekleşmediği durumlardan HHS haberdar olmayabilir.</p> <p>Müşteri GKD yapmadan ayrılmış olabilir. (ÖR: Browserı kapatmış olabilir)
Rıza Yetki Bekleniyor (B) statüsünde kalır.  5 dakika içerisinde sistem tarafından Yetki Bekleniyor (B) statüsündeki kayıtlar Rıza İptal  :Yetki Bekleniyor Süre Aşımı olarak güncellenir. Bkz. 9. Madde.</p></li> <li><p>GKD'nin gerçekleşmediği durumlardan HHS haberdardır. HHS yonlendirme adresinin query parametrelerine rizaIptDtyKod değerini ekleyerek bu durumu YÖS’e bildirmek zorundadır.</p> <ul><li><p>Rıza durumunun  “Yetkilendirildi&quot; , “Yetki Kullanıldı” olduğu durum.  Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨  I / 07</strong></p></li> <li><p>Rızano ile kimlik bilgileri uyuşmazlığı.  Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 08</strong></p></li> <li><p>ÖHK'nın HHS'de ilgili ürününün olmadığı durum (hesap/kart) Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨I / 09</strong></p></li> <li><p>Açık bankacılık kanalınız işleme kapalıdır.Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨I / 10</strong></p></li> <li><p>Kullanıcının HHS'deki hesaplarında yeterli yetkisinin olmama durumu  Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 11</strong></p></li> <li><p>ÖHK'nın ilgili HHS müşterisi olmadığı durum Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 12</strong></p></li> <li><p>HHS’nin ÖHK için yaptığı kontrollerin başarısız olduğu durum Yetki Bekleniyor ⇨ Yetki Iptal  <strong>B ⇨ I / 13</strong></p></li> <li><p>Müşteri kendini doğrulayamamış olabilir. Başarısız GKD Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 14</strong></p></li> <li><p>ÖHK isteği ile GKD’den vazgeçildiği durum Yetki Bekleniyor ⇨ Yetki Iptal <strong>B ⇨ I / 15</strong></p></li> <li><p>Diğer Yetki Bekleniyor ⇨  Yetki Iptal  <strong>B ⇨  I / 16</strong></p></li></ul></li></ul></li> <li><p>GKD muafiyeti olduğunda YÖS HHS’den arka planda onay alır. Bu onay sırasında rıza durumu <strong>Yetkilendirildi</strong> yapılır. <strong>B ⇨ Y</strong></p></li> <li><p>Erişim Belirteci'nin yetkilendirme kodu ile çağrımı yapıldığında; HHS, rıza numarasının Y - Yetkilendirildi statüsünde olduğunu kontrol etmelidir. Y statüsünde ise erişim belirteci tahsis edilir.
Erişim belirteci alındığında rıza durumu K: Yetki Kullanıldı yapılır. <strong>Y ⇨K</strong></p> <ul><li>Rıza durumu Yetki İptal - I statüsünde ya da Yetki Sonlandırıldı - S ise  <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Bekleniyor - B , Yetki Kullanıldı - K ya da Yetki ödeme emrine dönüştü - E ise <strong>TR.OBHS.Resource.ConsentMismatch</strong> hatası dönülmelidir.</li></ul> <p>Yenileme belirteci karşılığı erişim belirteci alınması sırasında rıza durumları aşağıdaki şekilde kontrol edilmelidir:</p> <ul><li>Ödeme emri için Yetki Kullanıldı – K veya Yetki ödeme emrine dönüştü – E rıza durumlarında yenileme belirteci karşılığı erişim belirteci alınabilir.</li> <li>Rıza durumu Yetki İptal - I statüsünde ise <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Sonlandırıldı - S ise öncelikle Yenileme Belirteci Geçerlik Süresi kontrolü yapılmalıdır. Geçerli bir Yenileme Belirteci olmadığı görülür ise <strong>TR.OBHS.Connection.InvalidToken</strong> hatası dönülmelidir. Aksi halde <strong>TR.OBHS.Resource.ConsentRevoked</strong> hatası dönülmelidir.</li> <li>Rıza durumu Yetki Bekleniyor - B ya da Yetkilendirildi - Y  ise <strong>TR.OBHS.Resource.ConsentMismatch</strong> hatası dönülmelidir.</li></ul></li> <li><p>Ödeme Başlatma API rıza kontolü ile işleme başlamalıdır.</p></li></ol> <p>Rıza durumu &quot;K: Yetki Kullanıldı” dışındakiler için  işleme devam edememelidir.<br>
Eğer rıza iptal statüsünde ise YÖS’ün haberi olması için bir hata kodu dönülür. <strong>TR.OBHS.Resource.ConsentRevoked</strong><br>
Diğer durumlarda aşağıdaki hata iletilmelidir: <strong>TR.OBHS.Resource.ConsentMismatch</strong></p> <ol start="6"><li><p>Sorgulama: GKD işleminin başarıyla tamamlanıp Ödeme Emri Rızasının yetkilendirilmesi esnasında, gönderen hesap seçiminin HHS ekranında yapıldığı durumlarda, ödeme emri isteğinde gönderen hesap bilgileri alanının zorunlu olması nedeniyle, ödemeEmriRizasi nesnesi sorgulanarak gönderen hesap bilgileri (hesap numarası ve/veya hesap referansı) alınmalıdır.
Rıza sorgulama, Ödeme Emri Sorgulama API'lerinde ilgili rıza kaydı bulunamaz veya sorgulayan kurumun yetkisi yoksa (örn : YÖS’ün farklı bir YÖS’e ait rıza noyu sorgulaması)<br> <strong>TR.OBHS.Resource.NotFound</strong> hatası verilmelidir.</p></li> <li><p>Ödeme Emri Rızasının İptali bulunmamaktadır.</p></li> <li><p>Ödeme Emri gerçekleştiğinde K: Yetki Kullanıldı Statüsü E: Yetki ödeme emrine dönüştü ye döner. <strong>K ⇨ E</strong></p></li> <li><p>HHS/YÖS tarafında rıza bilgileri belirli aralıklarla sistem kullanıcısı tarafından taranır:
5 dakikadan uzun süredir “Yetki Bekleniyor”  statüsünde kalan kayıtların statüleri güncellenir.
Yetki Bekleniyor ⇨ Rıza İptal / Süre Aşımı : Yetki Bekleniyor <strong>B ⇨ I / 04</strong></p> <p>5 dakikadan uzun süredir “Yetkilendirildi” statüsünde kalan kayıtlar statüleri güncellenir.
Yetkilendirildi     ⇨ Rıza İptal / Süre Aşımı : Yetkilendirildi <strong>B ⇨ I / 05</strong></p> <p>5 dakikadan uzun süredir “Yetki kullanıldı” statüsünde kalan kayıtlar statüleri güncellenir.
Yetki kullanıldı ⇨ Rıza İptal / Süre Aşımı : Yetki Ödemeye Dönüşmedi <strong>B ⇨ I / 06</strong></p> <p>Yenileme belirteci Son Tarih geldiğinde rıza statüsü Yetki ödeme emrine dönüştü’den Yetki Sonlandırıldı ya güncellenir.<br> <strong>E ⇨ S</strong></p></li> <li><p>GKD muafiyeti sadece ödeme başlatma servislerinde bulunmaktadır.</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v1.1.0/contents/temel-prensipler.html" class="prev">
        3. Temel Prensipler
      </a></span> <span class="next"><a href="/v1.1.0/contents/gkd.html">
        5. Güçlü Kimlik Doğrulama
      </a>
      →
    </span></p></div> <div class="footer-wrapper"><footer class="page-edit footer"><div class="footer-navigation"></div> <div class="footer-info"><p>© Tüm hakları saklıdır.  </p></div></footer></div></main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.64463254.js" defer></script><script src="/assets/js/6.3a0f8e93.js" defer></script><script src="/assets/js/2.7b95e2d3.js" defer></script><script src="/assets/js/18.48adad56.js" defer></script>
  </body>
</html>
